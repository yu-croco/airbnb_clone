= render 'partials/navbar'
.col-md-6
  %div
    = text_field_tag :search, params[:search], placeholder: "Where are you going?", class: "form-control",id:"pac-input"
.col-md-6
  #map.google-maps
    / google maps api
    %script
      // show selected area on map
      function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat:#{@latitude}, lng: #{@longitude}},
      zoom: 13
      });
      var input = (document.getElementById('pac-input'));

      var autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.bindTo('bounds', map);

      // show listings on map
      - if (@all_listings.present?)
        - @all_listings.each do |listing|
          markers = [];
          infowindows = [];
          var marker = new google.maps.Marker({
          position: new google.maps.LatLng(#{listing.latitude}, #{listing.longitude}),
          map: map
          });

          markers.push(marker);

          marker.addListener('click', function() {
          var content = "<div>" + '<a href="/listings/' + #{listing.id} +'">' + "<img src="+" #{listing.photos[0].image.url(:thumb)}" + " " + "style='width: 100%;height: 150px;'" +"alt='139'>" + "</a>" + '<br>' + "<h5>#{listing.listing_title}</h5>";

          var infowindow = new google.maps.InfoWindow({
          content: content,
          maxWidth: 280
          });

          infowindow.open(map, this);
          infowindows.push(infowindow);
          });
      }
  %script{:async => "", :defer => "defer", :src => "https://maps.googleapis.com/maps/api/js?key=#{Rails.application.secrets.GOOGLE_MAPS_KEY}&signed_in=true&libraries=places&callback=initMap"}
